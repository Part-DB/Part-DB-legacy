(function(factory){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function($){return factory($,window,document)})}else if(typeof exports==="object"){module.exports=function(root,$){if(!root){root=window}if(!$||!$.fn.dataTable){$=require("datatables.net")(root,$).$}return factory($,root,root.document)}}else{factory(jQuery,window,document)}})(function($,window,document,undefined){"use strict";var DataTable=$.fn.dataTable;var _instCounter=0;var FixedHeader=function(dt,config){if(!(this instanceof FixedHeader)){throw"FixedHeader must be initialised with the 'new' keyword."}if(config===true){config={}}dt=new DataTable.Api(dt);this.c=$.extend(true,{},FixedHeader.defaults,config);this.s={dt:dt,position:{theadTop:0,tbodyTop:0,tfootTop:0,tfootBottom:0,width:0,left:0,tfootHeight:0,theadHeight:0,windowHeight:$(window).height(),visible:true},headerMode:null,footerMode:null,autoWidth:dt.settings()[0].oFeatures.bAutoWidth,namespace:".dtfc"+_instCounter++,scrollLeft:{header:-1,footer:-1},enable:true};this.dom={floatingHeader:null,thead:$(dt.table().header()),tbody:$(dt.table().body()),tfoot:$(dt.table().footer()),header:{host:null,floating:null,placeholder:null},footer:{host:null,floating:null,placeholder:null}};this.dom.header.host=this.dom.thead.parent();this.dom.footer.host=this.dom.tfoot.parent();var dtSettings=dt.settings()[0];if(dtSettings._fixedHeader){throw"FixedHeader already initialised on table "+dtSettings.nTable.id}dtSettings._fixedHeader=this;this._constructor()};$.extend(FixedHeader.prototype,{enable:function(enable){this.s.enable=enable;if(this.c.header){this._modeChange("in-place","header",true)}if(this.c.footer&&this.dom.tfoot.length){this._modeChange("in-place","footer",true)}this.update()},headerOffset:function(offset){if(offset!==undefined){this.c.headerOffset=offset;this.update()}return this.c.headerOffset},footerOffset:function(offset){if(offset!==undefined){this.c.footerOffset=offset;this.update()}return this.c.footerOffset},update:function(){this._positions();this._scroll(true)},_constructor:function(){var that=this;var dt=this.s.dt;$(window).on("scroll"+this.s.namespace,function(){that._scroll()}).on("resize"+this.s.namespace,function(){that.s.position.windowHeight=$(window).height();that.update()});var autoHeader=$(".fh-fixedHeader");if(!this.c.headerOffset&&autoHeader.length){this.c.headerOffset=autoHeader.outerHeight()}var autoFooter=$(".fh-fixedFooter");if(!this.c.footerOffset&&autoFooter.length){this.c.footerOffset=autoFooter.outerHeight()}dt.on("column-reorder.dt.dtfc column-visibility.dt.dtfc draw.dt.dtfc column-sizing.dt.dtfc",function(){that.update()});dt.on("destroy.dtfc",function(){dt.off(".dtfc");$(window).off(that.s.namespace)});this._positions();this._scroll()},_clone:function(item,force){var dt=this.s.dt;var itemDom=this.dom[item];var itemElement=item==="header"?this.dom.thead:this.dom.tfoot;if(!force&&itemDom.floating){itemDom.floating.removeClass("fixedHeader-floating fixedHeader-locked")}else{if(itemDom.floating){itemDom.placeholder.remove();this._unsize(item);itemDom.floating.children().detach();itemDom.floating.remove()}itemDom.floating=$(dt.table().node().cloneNode(false)).css("table-layout","fixed").removeAttr("id").append(itemElement).appendTo("body");itemDom.placeholder=itemElement.clone(false);itemDom.placeholder.find("*[id]").removeAttr("id");itemDom.host.prepend(itemDom.placeholder);this._matchWidths(itemDom.placeholder,itemDom.floating)}},_matchWidths:function(from,to){var get=function(name){return $(name,from).map(function(){return $(this).width()}).toArray()};var set=function(name,toWidths){$(name,to).each(function(i){$(this).css({width:toWidths[i],minWidth:toWidths[i]})})};var thWidths=get("th");var tdWidths=get("td");set("th",thWidths);set("td",tdWidths)},_unsize:function(item){var el=this.dom[item].floating;if(el&&(item==="footer"||item==="header"&&!this.s.autoWidth)){$("th, td",el).css({width:"",minWidth:""})}else if(el&&item==="header"){$("th, td",el).css("min-width","")}},_horizontal:function(item,scrollLeft){var itemDom=this.dom[item];var position=this.s.position;var lastScrollLeft=this.s.scrollLeft;if(itemDom.floating&&lastScrollLeft[item]!==scrollLeft){itemDom.floating.css("left",position.left-scrollLeft);lastScrollLeft[item]=scrollLeft}},_modeChange:function(mode,item,forceChange){var dt=this.s.dt;var itemDom=this.dom[item];var position=this.s.position;var tablePart=this.dom[item==="footer"?"tfoot":"thead"];var focus=$.contains(tablePart[0],document.activeElement)?document.activeElement:null;if(mode==="in-place"){if(itemDom.placeholder){itemDom.placeholder.remove();itemDom.placeholder=null}this._unsize(item);if(item==="header"){itemDom.host.prepend(this.dom.thead)}else{itemDom.host.append(this.dom.tfoot)}if(itemDom.floating){itemDom.floating.remove();itemDom.floating=null}}else if(mode==="in"){this._clone(item,forceChange);itemDom.floating.addClass("fixedHeader-floating").css(item==="header"?"top":"bottom",this.c[item+"Offset"]).css("left",position.left+"px").css("width",position.width+"px");if(item==="footer"){itemDom.floating.css("top","")}}else if(mode==="below"){this._clone(item,forceChange);itemDom.floating.addClass("fixedHeader-locked").css("top",position.tfootTop-position.theadHeight).css("left",position.left+"px").css("width",position.width+"px")}else if(mode==="above"){this._clone(item,forceChange);itemDom.floating.addClass("fixedHeader-locked").css("top",position.tbodyTop).css("left",position.left+"px").css("width",position.width+"px")}if(focus&&focus!==document.activeElement){focus.focus()}this.s.scrollLeft.header=-1;this.s.scrollLeft.footer=-1;this.s[item+"Mode"]=mode},_positions:function(){var dt=this.s.dt;var table=dt.table();var position=this.s.position;var dom=this.dom;var tableNode=$(table.node());var thead=tableNode.children("thead");var tfoot=tableNode.children("tfoot");var tbody=dom.tbody;position.visible=tableNode.is(":visible");position.width=tableNode.outerWidth();position.left=tableNode.offset().left;position.theadTop=thead.offset().top;position.tbodyTop=tbody.offset().top;position.theadHeight=position.tbodyTop-position.theadTop;if(tfoot.length){position.tfootTop=tfoot.offset().top;position.tfootBottom=position.tfootTop+tfoot.outerHeight();position.tfootHeight=position.tfootBottom-position.tfootTop}else{position.tfootTop=position.tbodyTop+tbody.outerHeight();position.tfootBottom=position.tfootTop;position.tfootHeight=position.tfootTop}},_scroll:function(forceChange){var windowTop=$(document).scrollTop();var windowLeft=$(document).scrollLeft();var position=this.s.position;var headerMode,footerMode;if(!this.s.enable){return}if(this.c.header){if(!position.visible||windowTop<=position.theadTop-this.c.headerOffset){headerMode="in-place"}else if(windowTop<=position.tfootTop-position.theadHeight-this.c.headerOffset){headerMode="in"}else{headerMode="below"}if(forceChange||headerMode!==this.s.headerMode){this._modeChange(headerMode,"header",forceChange)}this._horizontal("header",windowLeft)}if(this.c.footer&&this.dom.tfoot.length){if(!position.visible||windowTop+position.windowHeight>=position.tfootBottom+this.c.footerOffset){footerMode="in-place"}else if(position.windowHeight+windowTop>position.tbodyTop+position.tfootHeight+this.c.footerOffset){footerMode="in"}else{footerMode="above"}if(forceChange||footerMode!==this.s.footerMode){this._modeChange(footerMode,"footer",forceChange)}this._horizontal("footer",windowLeft)}}});FixedHeader.version="3.1.3";FixedHeader.defaults={header:true,footer:false,headerOffset:0,footerOffset:0};$.fn.dataTable.FixedHeader=FixedHeader;$.fn.DataTable.FixedHeader=FixedHeader;$(document).on("init.dt.dtfh",function(e,settings,json){if(e.namespace!=="dt"){return}var init=settings.oInit.fixedHeader;var defaults=DataTable.defaults.fixedHeader;if((init||defaults)&&!settings._fixedHeader){var opts=$.extend({},defaults,init);if(init!==false){new FixedHeader(settings,opts)}}});DataTable.Api.register("fixedHeader()",function(){});DataTable.Api.register("fixedHeader.adjust()",function(){return this.iterator("table",function(ctx){var fh=ctx._fixedHeader;if(fh){fh.update()}})});DataTable.Api.register("fixedHeader.enable()",function(flag){return this.iterator("table",function(ctx){var fh=ctx._fixedHeader;flag=flag!==undefined?flag:true;if(fh&&flag!==fh.s.enable){fh.enable(flag)}})});DataTable.Api.register("fixedHeader.disable()",function(){return this.iterator("table",function(ctx){var fh=ctx._fixedHeader;if(fh&&fh.s.enable){fh.enable(false)}})});$.each(["header","footer"],function(i,el){DataTable.Api.register("fixedHeader."+el+"Offset()",function(offset){var ctx=this.context;if(offset===undefined){return ctx.length&&ctx[0]._fixedHeader?ctx[0]._fixedHeader[el+"Offset"]():undefined}return this.iterator("table",function(ctx){var fh=ctx._fixedHeader;if(fh){fh[el+"Offset"](offset)}})})});return FixedHeader});